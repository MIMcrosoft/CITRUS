<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire de match</title>
    <link rel="stylesheet" href="../static/stylesheets/components/generalStyles.css">
</head>
<body>
    <h2 class="formTitle">Formulaire de match</h2>
    <div class="topContainer">
        <div class="logoBoard">
            <img src="../static/icons/CitrusLogo.png" alt="" class="logo">
            <h2 class="logoX">X</h2>
            <img src="../static/icons/CitrusLogo.png" alt="" class="logo">
        </div>
        <div class="teamBoard">
            <p>Équipe 1 rc. Équipe 2</p>
            <p>24 septembre 2024</p>
        </div>
    </div>
    <div class="select tab-select" style="width: 100%;">
        <select name="" id="" onchange="showSection(this)">
            <option value="Alignement">Alignement</option>
            <option value="Alignement" selected>Alignement</option>
            <option value="Match">Match</option>
            <option value="Pénalités">Pénalités</option>
            <option value="Score">Score et signatures</option>
        </select>
    </div>
    <section id="Alignement" class="">
        <div class="team" id="alignement1">
            <h3>MIM de Montmorency</h3>
            <div class="player player1">
                <p></p>
                <p>1</p>
                <p>Il</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player1">
                <p></p>
                <p>15</p>
                <p>Elle/Iel</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player1">
                <p></p>
                <p>23</p>
                <p>Il/Iel</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player1">
                <p></p>
                <p>37</p>
                <p>Il/Elle</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player1">
                <p>A</p>
                <p>13</p>
                <p>Elle</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player1">
                <p>A</p>
                <p>42</p>
                <p>Il</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player1">
                <p>C</p>
                <p>18</p>
                <p>Il</p>
                <p>Cédric Sirois-Tanguay</p>
            </div>
            <div class="coach">
                <p>Coach</p>
                <p>Elle</p>
                <p>Adeline Gascon</p>
            </div>
            <button class="btnPrimary btnStretch" onclick="openModal('addPlayerModal');document.getElementById('team').value = 1"><span>Ajouter un remplaçant</span></button>
        </div>
        <div class="team" id="alignement2">
            <h3>MIM de Montmorency</h3>
            <div class="player player2">
                <p></p>
                <p>1</p>
                <p>Il</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player2">
                <p></p>
                <p>15</p>
                <p>Elle/Iel</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player2">
                <p></p>
                <p>23</p>
                <p>Il/Iel</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player2">
                <p></p>
                <p>37</p>
                <p>Il/Elle</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player2">
                <p>A</p>
                <p>13</p>
                <p>Elle</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player2">
                <p>A</p>
                <p>42</p>
                <p>Il</p>
                <p>Raphaël Dumont</p>
            </div>
            <div class="player player2">
                <p>C</p>
                <p>18</p>
                <p>Il</p>
                <p>Cédric Sirois-Tanguay</p>
            </div>
            <div class="coach">
                <p>Coach</p>
                <p>Elle</p>
                <p>Adeline Gascon</p>
            </div>
            <button class="btnPrimary btnStretch" onclick="openModal('addPlayerModal');document.getElementById('team').value = 2"><span>Ajouter un remplaçant</span></button>
        </div>
    </section>
    <section id="Match" class="hidden">
        <div class="impro">
            <p>1.</p>
            <input type="text" id="impro1" onchange="saveToDB(this)">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>2.</p>
            <input type="text" id="impro2">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>3.</p>
            <input type="text" id="impro3">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>4.</p>
            <input type="text" id="impro4">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>5.</p>
            <input type="text" id="impro5">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>6.</p>
            <input type="text" id="impro6">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>7.</p>
            <input type="text" id="impro7">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>8.</p>
            <input type="text" id="impro8">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>9.</p>
            <input type="text" id="impro9">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>10.</p>
            <input type="text" id="impro10">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>11.</p>
            <input type="text" id="impro11">
            <div class="select">
                <select name="" id="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro">
            <p>12.</p>
            <input type="text" id="impro12">
            <div class="select">
                <select name="" id="lastPoint" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="unset">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                    <option value="both">Les deux</option>
                </select>
            </div>
        </div>
        <div class="impro" id="prolong">
            <p>Pr.</p>
            <input type="text" id="impro13">
            <div class="select">
                <select name="" class="point" onchange="saveToDB(this); updatePoint()">
                    <option value="">Point</option>
                    <option value="team1">Équipe1</option>
                    <option value="team2">Équipe2</option>
                </select>
            </div>
        </div>
        <button class="btnPrimary btnStretch" style="margin-top: 1rem;"><span>Terminer le match</span></button>
    </section>
    <section id="Pénalités" class="hidden">
        <h3 class="nopenalty">Aucune pénalité</h3>
        <button class="btnPrimary btnStretch addPun" style="margin-top: 1rem;" onclick="openModal('addPunModal')"><span>Ajouter une pénalité</span></button>
    </section>
    <section id="Score" class="hidden">
        <div class="scoreBoard">
            <div class="logos">
                <img src="../static/icons/CitrusLogo.png" alt="" class="logo">
                <img src="../static/icons/CitrusLogo.png" alt="" class="logo">
            </div>
            <div class="results">
                <span id="team1Points">0</span>
                <span>Points</span>
                <span id="team2Points">0</span>
            </div>
            <div class="results">
                <span id="team1Puns">0</span>
                <span>Pénalités</span>
                <span id="team2Puns">0</span>
            </div>
            <div class="results">
                <span class="biggerNum" id="team1Score">0</span>
                <span class="biggerNum">Score</span>
                <span class="biggerNum" id="team2Score">0</span>
            </div>
        </div>
        <div class="sign">
            <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Signatures</h3>
            <label for="coach1" class="label onTop">Nom du Coach, Équipe</label>
            <input type="text" id="coach1">
            <label for="coach2" class="label onTop">Nom du Coach, Équipe</label>
            <input type="text" id="coach2">
            <button type="submit" class="btnPrimary btnInline"><span>Confirmer l'envoi</span></button>
        </div>
        
    </section>
    <div id="modal" class="modal" data-modal="addPlayerModal">
        <div class="modalContent">
            <div class="modalHeader">
                <h1>Ajouter un remplaçant</h1>
                <span class="close" id="modalClose" onclick="closeModal('addPlayerModal')">&times;</span>
            </div>
            <form id="addPlayerForm">
            <div class="modalBody">
                    <label for="number" class="label onTop">Numéro</label>
                    <input type="text" id="number">
                    <label for="pronouns" class="label onTop">Pronom(s)</label>
                    <input type="text" id="pronoun">
                    <label for="name" class="label onTop">Prénom et nom</label>
                    <input type="text" id="name">
                    <input type="text" id="team" value="1" style="display: none;">
            </div>
            <div class="modalFooter">
                <button type="button" class="btnSecondary btnInline" onclick="closeModal('addPlayerModal')"><span>Annuler</span></button>
                <button type="submit" class="btnPrimary btnInline"><span>Ajouter</span></button>
            </div>
            </form>
        </div>
    </div>
    <div id="modal" class="modal" data-modal="addPunModal">
        <div class="modalContent">
            <div class="modalHeader">
                <h1>Ajouter une pénalité</h1>
                <span class="close" id="modalClose" onclick="closeModal('addPunModal')">&times;</span>
            </div>
            <form id="addPunForm">
            <div class="modalBody">
                <label for="who" class="label onTop">Inteprète/Équipe</label>
                <div class="select select-search">
                    <select name="" id="who">
                        <option value=""></option>
                        <option value="team1">Équipe1</option>
                        <option value="team2">Équipe2</option>
                        <option value="team1">Inteprète</option>
                    </select>  
                </div>
                <label for="pun" class="label onTop">Punition</label>
                <div class="select select-search">
                    <select name="" id="pun">
                        <option value=""></option>
                        <option value="Rudesse">Rudesse</option>
                        <option value="Refus de personnagee">Refus de personnage</option>
                        <option value="Pun">Pun</option>
                    </select>
                </div>
                <label for="maj" class="label onTop">Majeure</label>
                <div class="select">
                    <select name="" id="maj">
                        <option value=""></option>
                        <option value="Oui">Oui</option>
                        <option value="" selected>Non</option>
                    </select>
                </div>     
            </div>
            <div class="modalFooter">
                <button class="btnSecondary btnInline" onclick="closeModal('addPunModal')"><span>Annuler</span></button>
                <button type="submit" class="btnPrimary btnInline"><span>Ajouter</span></button>
            </div>
            </form>
        </div>
    </div>
    <style>
        body {
            background: var(--gradient);
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--white);
            padding: 1.5rem;
            font-size: 15px !important;
        }

        h3 {
            text-align: center;
            margin: 0.75rem;
        }

        p {
            color: var(--white);
            font-weight: 500;
            font-size: 1rem;
            margin: 0.2rem;
        }

        .hidden {
            display: none;
        }

        .formTitle {
            color: var(--white);
            margin-top: 2rem;
            font-size: 1.5rem;
        }

        .logoBoard {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 1rem;
        }

        .logoBoard .logo {
            height: 6rem;
        }

        .logoX {
            color: var(--white);
            font-size: 3rem;
            line-height: 1rem;
            padding: 0 3rem;
        }

        .teamBoard {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2rem;
        }

        .teamBoard p {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--white);
        }

        section {
            width: 100%;
        }

        .player, .coach {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding: 0.2rem 0;
            position: relative;
        }

        .coach {
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .player p, .coach p {
            flex-basis: 8%;
            text-align: center;
            margin-right: 1rem;
        }

        .coach p:nth-child(1) {
            flex-basis: 16%;
            margin-right: 2.2rem;
        }

        .player p:nth-child(3), .coach p:nth-child(2) {
            flex-basis: 15%;
        }

        .player p:nth-child(4), .coach p:nth-child(3) {
            flex-grow: 1;
            text-align: start;
        }

        .player.crossed::after, .coach.crossed::after, .pun.crossed::after {
            content: "";
            width: 100%;
            height: 2px;
            background: var(--white);
            position: absolute;
            top: 50%;
        }
        
        @media (hover:hover) {
            .player:hover::after, .coach:hover::after, .pun:hover::after {
                content: "";
                width: 100%;
                height: 2px;
                background: var(--white);
                position: absolute;
                top: 50%;
            }
        }

        .modalBody input, .modalBody div {
            width: 100%;
        }

        .impro {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding: 0.2rem 0;
            position: relative;
        }

        .impro p {
            flex-basis: 8%;
            text-align: center;
        }


        .impro input{
            width: auto;
            margin-right: 0.5rem;
            margin-bottom: 0;
        }

        .impro .select {
            width: 7rem;
            margin-bottom: 0;
        }

        #prolong {
            display: none;
        }

        .impro .select .select-selected {
            overflow: hidden;
        }

        .pun {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding: 0.2rem 0;
            position: relative;
        }

        .pun p {
            flex-basis: 27%;
            text-align: center;
            margin-right: 1rem;
        }

        .pun i {
            flex-basis: 9%;
            text-align: center;
            margin-right: 1rem;
        }

        .scoreBoard {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .scoreBoard .logos{
            width: 100%;
            display: flex;
            flex-direction: row;
            justify-content: space-around;
        }

        .scoreBoard .logo {
            height: 7rem;
        }

        .scoreBoard .results {
            width: 100%;
            display: grid;
            grid-template-columns: 3fr 2fr 3fr;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .scoreBoard .results * {
            text-align: center;
            font-size: 1.7rem;
            font-weight: 500;
        }

        .scoreBoard .results span:nth-child(2) {
            font-size: 1.2rem;
        }

        .scoreBoard .results .biggerNum {
            font-size: 2rem;
            font-weight: 600;
        }

        .scoreBoard .results span.biggerNum:nth-child(2) {
            font-size: 1.7rem;
            font-weight: 600;
        }

        .sign input {
            width: 100%;
        }

        .sign label {
            color: var(--white);
            font-weight: 400;
        }

        .sign button {
            width: 100%;
        }
    </style>

    <script>
        function saveToDB(el) {
            let inputValue = el.value;
            let inputID = el.id;
            let userID = saveID;
            //To add link to DB
        }

        let score = [0, 0];
        let points = [0, 0];
        let puns = [0, 0];

        function updatePoint() {
            let pointsList = document.querySelectorAll(".point");
            points = [0, 0];
            for (i=0;i<pointsList.length;i++) {
                if (pointsList[i].value == "team1") {
                    points[0]++
                } else if (pointsList[i].value == "team2") {
                    points[1]++
                } else if (pointsList[i].value == "both") {
                    points[0]++
                    points[1]++
                }
            }
            updateScore();
            console.log("Updating Points : " + points[0] + " - " + points[1])
        }

        function updatePun() {
            let punsList = document.querySelectorAll(".pun");
            puns = [0, 0];
            for (i=0;i<punsList.length;i++) {
                if (punsList[i].getAttribute("data-pun") == "team1") {
                    puns[0] = puns[0] + Number(punsList[i].getAttribute("data-punvalue"));
                } else if (punsList[i].getAttribute("data-pun") == "team2") {
                    puns[1] = puns[1] + Number(punsList[i].getAttribute("data-punvalue"));
                }
            }
            updateScore();
            console.log("Updating Pun : " + puns[0] + " - " + puns[1])
        }

        function updateScore() {
            let tradePun = Array.from(puns);
            console.log(tradePun);
            score = Array.from(points);
            while (tradePun[0]>=3) {
                score[1]++
                tradePun[0] = tradePun[0]-3;
            }
            while (tradePun[1]>=3) {
                score[0]++
                tradePun[1] = tradePun[1]-3;
            }
            if (document.getElementById("lastPoint").value != "unset" && score[0] == score[1]) {
                console.log(document.getElementById("lastPoint").value)
                document.getElementById("prolong").style.display="flex";
            } else {
                document.getElementById("prolong").style.display="none";
                document.getElementById("prolong").getElementsByClassName("select").value="";
                document.getElementById("prolong").getElementsByClassName("input").value="";
            }

            document.getElementById("team1Points").innerText = points[0];
            document.getElementById("team2Points").innerText = points[1];
            document.getElementById("team1Puns").innerText = puns[0];
            document.getElementById("team2Puns").innerText = puns[1];
            document.getElementById("team1Score").innerText = score[0];
            document.getElementById("team2Score").innerText = score[1];
        }

        // Function to check for local storage and set saveID
        function setSaveID() {
            let saveID = null;
            // Check if userID exists in local storage
            if (localStorage.getItem('userID')) {
                saveID = localStorage.getItem('userID');
            } 
            // Check if deviceID exists in local storage
            else if (localStorage.getItem('deviceID')) {
                saveID = localStorage.getItem('deviceID');
            } 
            // If neither userID nor deviceID exists, create a new deviceID
            else {
                // Detect the device type
                let deviceType = detectDeviceType();
                // Detect the browser
                let browserName = detectBrowser();
                // Generate a random 5-digit number
                let randomNum = Math.floor(10000 + Math.random() * 90000);
                // Create a new deviceID
                let newID = `${deviceType}${browserName}${randomNum}`;
                
                // Set the new deviceID to local storage
                localStorage.setItem('deviceID', newID);
                saveID = newID;
            }

            // Return or use saveID as needed
            return saveID;
        }

        // Function to detect the type of device
        function detectDeviceType() {
            let userAgent = navigator.userAgent || navigator.vendor || window.opera;

            if (/iPhone/i.test(userAgent)) {
                return 'iPhone';
            } else if (/android/i.test(userAgent)) {
                return 'Android';
            } else if (/Macintosh/i.test(userAgent)) {
                return 'Mac';
            } else if (/Windows/i.test(userAgent)) {
                return 'PC';
            } else {
                return 'Generic';
            }
        }

        // Function to detect the browser
        function detectBrowser() {
            let userAgent = navigator.userAgent;

            if (userAgent.indexOf("Firefox") > -1) {
                return 'Firefox';
            } else if (userAgent.indexOf("SamsungBrowser") > -1) {
                return 'SamsungBrowser';
            } else if (userAgent.indexOf("Opera") > -1 || userAgent.indexOf("OPR") > -1) {
                return 'Opera';
            } else if (userAgent.indexOf("Trident") > -1) {
                return 'IE'; // Internet Explorer
            } else if (userAgent.indexOf("Edge") > -1) {
                return 'Edge';
            } else if (userAgent.indexOf("Chrome") > -1) {
                return 'Chrome';
            } else if (userAgent.indexOf("Safari") > -1) {
                return 'Safari';
            } else {
                return 'UnknownBrowser';
            }
        }

        // Example usage
        let saveID = setSaveID();
        console.log(saveID);

        function showSection(el){
            const sections = document.getElementsByTagName("section");
            const section = el.value;
            console.log(el);
            for (i=0;i<sections.length;i++) {
                sections[i].classList.add("hidden");
            }
            document.getElementById(section).classList.remove("hidden");
        }

        let players = document.querySelectorAll('.player, .coach');
        for (let i = 0; i<players.length;i++) {
            players[i].addEventListener("click", function() {
                players[i].classList.toggle("crossed")
            })
        }

    </script>

    <script>
        /* À ajouter une fois si dropdowns présents */
        // Variables globales
        var selectContainers, selectElements, optionsCount, i, j;
        var selectedDiv, optionsDiv, optionDiv, searchDiv, searchInput, clearSpan, noResultsDiv;

        // Rechercher tous les éléments avec la classe "select"
        selectContainers = document.getElementsByClassName("select");
        var containerCount = selectContainers.length;

        // Parcourir chaque conteneur de sélection
        for (i = 0; i < containerCount; i++) {
            // Sélectionner l'élément <select> à l'intérieur du conteneur
            selectElements = selectContainers[i].getElementsByTagName("select")[0];
            optionsCount = selectElements.length;

            // Créer un nouveau DIV pour afficher l'élément sélectionné
            selectedDiv = document.createElement("DIV");
            selectedDiv.setAttribute("class", "select-selected");
            selectedDiv.innerHTML = selectElements.options[selectElements.selectedIndex].innerHTML;
            selectContainers[i].appendChild(selectedDiv);

            // Créer un nouveau DIV pour contenir la liste des options
            optionsDiv = document.createElement("DIV");
            optionsDiv.setAttribute("class", "select-items select-hide");

            // Si le conteneur de sélection a la classe "select-search", ajouter une barre de recherche
            if (selectContainers[i].classList.contains("select-search")) {
                searchDiv = document.createElement("div");
                searchDiv.classList.add("select-search-bar");

                searchInput = document.createElement("input");
                searchInput.setAttribute("type", "text");
                searchInput.setAttribute("placeholder", "Rechercher...");
                searchInput.setAttribute("onkeyup", "filterSearch(this)");
                searchInput.classList.add("select-search-bar-input");

                clearSpan = document.createElement("span");
                clearSpan.innerHTML = "×";
                clearSpan.classList.add("select-search-clear");
                clearSpan.addEventListener("click", function() {
                    this.previousSibling.value = "";
                    filterSearch(this.previousSibling);
                });

                searchDiv.appendChild(searchInput);
                searchDiv.appendChild(clearSpan);
                optionsDiv.appendChild(searchDiv);
            }

            // Parcourir chaque option dans l'élément <select>
            for (j = 1; j < optionsCount; j++) {
                // Créer un nouveau DIV pour chaque option
                optionDiv = document.createElement("DIV");
                optionDiv.innerHTML = selectElements.options[j].innerHTML;
                optionDiv.classList.add("select-option");
                if (selectElements.options[j].selected) {
                    optionDiv.classList.add("same-as-selected");
                }
                optionDiv.addEventListener("click", function(e) {
                    // Lorsque l'option est cliquée, mettre à jour l'élément <select> original et l'élément sélectionné
                    var selectElement, optionsLength, optionText, selectedDiv, allSelectedDivs;

                    selectElement = this.parentNode.parentNode.getElementsByTagName("select")[0];
                    optionsLength = selectElement.length;
                    selectedDiv = this.parentNode.previousSibling;
                    
                    for (var k = 0; k < optionsLength; k++) {
                        if (selectElement.options[k].innerText === this.innerText) {
                            selectElement.selectedIndex = k;
                            console.log("set to " + selectElement.value)
                            selectedDiv.innerHTML = this.innerHTML;
                            allSelectedDivs = this.parentNode.getElementsByClassName("same-as-selected");
                            
                            for (var l = 0; l < allSelectedDivs.length; l++) {
                                allSelectedDivs[l].removeAttribute("class");
                            }
                            
                            this.setAttribute("class", "same-as-selected");
                            selectElement.dispatchEvent(new Event('change'));
                            break;
                        }
                        
                    }

                    selectedDiv.click();
                });
                optionsDiv.appendChild(optionDiv);
            }

            // Ajouter le DIV pour les résultats inexistants
            noResultsDiv = document.createElement("DIV");
            noResultsDiv.innerHTML = "Aucun résultats";
            noResultsDiv.classList.add("select-noResults");
            optionsDiv.appendChild(noResultsDiv);

            // Ajouter le DIV des options au conteneur de sélection
            selectContainers[i].appendChild(optionsDiv);

            // Ajouter un événement de clic au DIV sélectionné pour ouvrir/fermer la liste des options
            selectedDiv.addEventListener("click", function(e) {
                e.stopPropagation();
                closeAllSelect(this);
                this.nextSibling.classList.toggle("select-hide");
                this.classList.toggle("select-arrow-active");

                // Si le conteneur de sélection a la classe "select-search", focaliser la barre de recherche
                if (this.parentNode.classList.contains("select-search")) {
                    let searchInput = selectContainers[i].parentNode.getElementsByClassName("select-search-bar-input")[0];
                    console.log(selectContainers[i])
                    searchInput.focus();
                    this.nextElementSibling.scroll(0, 0);
                }
            });
        }

        // Fonction pour fermer tous les menus de sélection sauf celui spécifié
        function closeAllSelect(elmnt) {
            var selectItemsDivs, selectedDivs, i, totalItems, totalSelectedDivs, excludedIndexes = [];

            selectItemsDivs = document.getElementsByClassName("select-items");
            selectedDivs = document.getElementsByClassName("select-selected");
            totalItems = selectItemsDivs.length;
            totalSelectedDivs = selectedDivs.length;

            for (i = 0; i < totalSelectedDivs; i++) {
                if (elmnt === selectedDivs[i]) {
                    excludedIndexes.push(i);
                } else {
                    selectedDivs[i].classList.remove("select-arrow-active");
                }
            }

            for (i = 0; i < totalItems; i++) {
                if (!excludedIndexes.includes(i)) {
                    selectItemsDivs[i].classList.add("select-hide");
                }
            }

            // Retirer le focus des barres de recherche
            let searchInputs = document.getElementsByClassName("select-search-bar-input");
            for (let i = 0; i < searchInputs.length; i++) {
                searchInputs[i].blur();
            }
        }

        // Fermer tous les menus de sélection si l'utilisateur clique en dehors
        document.addEventListener("click", function(event) {
            if (event.target.closest(".select-search-bar")) return;
            closeAllSelect();
        });

        // Fonction pour filtrer les options en fonction de la recherche
        function filterSearch(searchBar) {
            let noResults = true;
            let filter = searchBar.value.toUpperCase();
            let optionsDiv = searchBar.parentNode.parentNode;
            let options = optionsDiv.getElementsByClassName("select-option");

            for (let i = 0; i < options.length; i++) {
                let optionText = options[i].textContent || options[i].innerText;
                if (optionText.toUpperCase().indexOf(filter) > -1) {
                    options[i].style.display = "";
                    noResults = false;
                } else {
                    options[i].style.display = "none";
                }
            }

            // Afficher ou masquer le message "Aucun résultats"
            optionsDiv.getElementsByClassName("select-noResults")[0].style.display = noResults ? "block" : "none";
        }

    </script>

    <script>
        function openModal(modalName) {
            let modal = document.querySelector("[data-modal='"+modalName+"']");
            modal.style.display="block";
        }

        function closeModal(modalName) {
            let modal = document.querySelector("[data-modal='"+modalName+"']");
            modal.style.display="none";
        }
    </script>
    <script>
        document.getElementById('addPlayerForm').addEventListener('submit', function (e) {
            console.log("Submitted")
            e.preventDefault();  // Prevent form from submitting and refreshing the page

            // Collect input values
            const playerName = document.getElementById('name').value;
            const playerNumber = parseInt(document.getElementById('number').value);  // Ensure it's an integer
            const playerPronoun = document.getElementById('pronoun').value;
            const playerTeam = document.getElementById('team').value;

            // Create player object
            const newPlayer = {
                name: playerName,
                number: playerNumber,
                pronoun: playerPronoun
            };

            // Call addPlayer function with the new player object
            addPlayer(newPlayer, playerTeam);

            // Close modal after adding the player
            closeModal('addPlayerModal');
            
            // Optionally, clear the form for future use
            document.getElementById('addPlayerForm').reset();
        });

        function addPlayer(playerInfo, team) {
        const {name, number, pronoun} = playerInfo;
        const teamDiv = document.getElementById("alignement"+team);  // Get the team container
        const players = document.getElementsByClassName("player"+team);  // Get all players
        console.log(team)

        const newPlayerHtml = `
        <div class="player player${team}" onclick="this.classList.toggle('crossed')">
            <p></p>
            <p>${number}</p>
            <p>${pronoun}</p>
            <p>${name}</p>
        </div>
    `;

        let inserted = false; // Flag to track if the player is inserted

        // Loop through all existing players and find the correct position
        for (let i = 0; i < players.length; i++) {
            const player = players[i];
            const playerPosition = player.querySelector('p:nth-child(1)').innerText;  // First 
            const playerNumber = parseInt(player.querySelector('p:nth-child(2)').innerText);

            // If there's a letter in the first column, skip it (do not consider for sorting)
            if (playerPosition != '') {
                player.insertAdjacentHTML('beforebegin', newPlayerHtml);
                inserted = true;
                break;
            }

            // Insert before the first player whose number is larger than the new player's number
            if (playerNumber > number) {
                player.insertAdjacentHTML('beforebegin', newPlayerHtml);
                inserted = true;
                break;
            }
        }

        // If the player wasn't inserted, append them to the end
        if (!inserted) {
            teamDiv.insertAdjacentHTML('beforeend', newPlayerHtml);
        }
    }

    document.getElementById('addPunForm').addEventListener('submit', function (e) {
            console.log("Submitted")
            e.preventDefault();

            const punWho = document.getElementById('who').options[document.getElementById('who').selectedIndex].text;
            const punValue = document.getElementById('who').value;
            const punName = document.getElementById('pun').value;
            const punMaj = document.getElementById('maj').value ;
            let punMajValue = 0;
            if (punMaj == "Oui") {
                punMajValue = 2;
            } else {
                punMajValue = 1
            }

            const newPunHtml = `
                <div class="pun" data-pun=${punValue} data-punValue=${punMajValue}>
                    <p>${punWho}</p>
                    <p>${punName}</p>
                    <p>${punMaj}</p>
                    <i class="fa-solid fa-trash" onclick="removePun(this)"></i>
                </div>
            `;
            
            document.querySelector(".nopenalty").style.display="none";
            document.querySelector(".addPun").insertAdjacentHTML('beforebegin', newPunHtml)

            // Close modal after adding the player
            closeModal('addPunModal');
            
            // Optionally, clear the form for future use
            updatePun()
            });
        
        function removePun(el) {
            el.parentNode.remove();
            if (document.getElementsByClassName("pun").length == 0) {
                document.querySelector(".nopenalty").style.display="block";
            }
            updatePun();
        }

    </script>
    <script src="https://kit.fontawesome.com/b6c9a53dc1.js" crossorigin="anonymous"></script>
</body>
</html>